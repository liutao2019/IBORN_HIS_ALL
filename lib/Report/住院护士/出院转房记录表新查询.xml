<ReportQueryInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.ReportQueryInfo,SOC.HISFC.OutpatientFee.Components"><List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>0</Index><Name>dtBeginTime</Name><Text>开始时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>-1</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd HH:mm</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>150</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>1</Index><Name>dtEndTime</Name><Text>结束时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>0</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd HH:mm</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>150</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>250</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List></List><QueryDataSource><QueryDataSource Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryDataSource,SOC.HISFC.OutpatientFee.Components"><Name>dt</Name><Sql>select * from(


select t1.name,(replace(t1.home_tel,substr(t1.home_tel,4,4),'****')) phone, t1.patient_no,t.inpatient_no,substr(t.old_bed_code,5,8) old_bed,substr(t.new_bed_code,5,8) new_bed,t.confirm_date confirm_date from fin_ipr_shiftapply t left join fin_ipr_inmaininfo t1 on t.inpatient_no=t1.inpatient_no where t.shift_state=2 --order by t1.name,t.confirm_date

 union all
select t.name,(replace(t.home_tel,substr(t.home_tel,4,4),'****')) phone, t.patient_no,t.inpatient_no,'' old_bed, case when t.in_state='I' then ('入院'|| (case when sd.inpatient_no is not null then substr(sd.old_bed_code,5,8) else replace(t.bed_no,t.nurse_cell_code,'') end)) 
    else  ('出院' || replace(t.bed_no,t.nurse_cell_code,'')) end new_bed,case when t.in_state='I' then t.IN_DATE else  t.out_date end confirm_date 
    from fin_ipr_inmaininfo t
    left join (select INPATIENT_NO,min(OPER_DATE) OPER_DATE from fin_ipr_shiftapply where shift_state=2  group by INPATIENT_NO) g on t.inpatient_no=g.inpatient_no 
    left join fin_ipr_shiftapply sd on sd.inpatient_no=g.inpatient_no  and sd.OPER_DATE=g.OPER_DATE
   where t.in_state in('B','O','I')  and t.patient_no not like 'B%' --order by t.out_date desc;

union all

select distinct t.name,(replace(t.home_tel,substr(t.home_tel,4,4),'****')) phone,t.patient_no,t.inpatient_no,'' old_bed, case when a.inpatient_no is null then ('入院'|| replace(t.bed_no,t.nurse_cell_code,'')) else '有转床' end  new_bed, c.OPER_DATE confirm_date from fin_ipr_inmaininfo t left join COM_SHIFTDATA c on t.inpatient_no=c.CLINIC_NO 
   left join fin_ipr_shiftapply a on t.inpatient_no=a.inpatient_no 
   where  c.SHIFT_TYPE='B' and a.shift_state=2 

) t where t.confirm_date between to_date('&amp;dtBeginTime','yyyy-mm-dd hh24:mi:ss') and to_date('&amp;dtEndTime','yyyy-mm-dd hh24:mi:ss')+1  order by t.name,t.confirm_date
</Sql><AddMapRow>false</AddMapRow><AddMapColumn>true</AddMapColumn><AddMapData>true</AddMapData><AddMapSourceData>true</AddMapSourceData><IsCross>false</IsCross><SqlType>MainReportUsing</SqlType><CrossRows></CrossRows><CrossColumns></CrossColumns><CrossValues></CrossValues><CrossCombinColumns></CrossCombinColumns><SumColumns></SumColumns><CrossGroupColumns></CrossGroupColumns><IsSumRow>true</IsSumRow><SumRows></SumRows><RowGroup /></QueryDataSource></QueryDataSource><QueryFilePath>Report\住院护士\出院转房记录表新查询.xml</QueryFilePath><PrintInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.PrintInfo,SOC.HISFC.OutpatientFee.Components"><PaperSize Type="System.Drawing.Printing.PaperSize,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Height>1169</Height><PaperName>A4</PaperName><RawKind>0</RawKind><Width>850</Width></PaperSize><SelectPage>false</SelectPage></PrintInfo></ReportQueryInfo>