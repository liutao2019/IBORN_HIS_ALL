<ReportQueryInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.ReportQueryInfo,SOC.HISFC.OutpatientFee.Components"><List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>0</Index><Name>dtBeginTime</Name><Text>开始时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>-1</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>1</Index><Name>dtEndTime</Name><Text>结束时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>0</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>220</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>2</Index><Name>name</Name><Text>姓名：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.TextBoxType,SOC.HISFC.OutpatientFee.Components"><IsPadLeft>false</IsPadLeft><Length>10</Length><PadLeftName>0</PadLeftName><DefaultDataSource></DefaultDataSource><IsEnterFilter>true</IsEnterFilter><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>450</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List></List><QueryDataSource><QueryDataSource Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryDataSource,SOC.HISFC.OutpatientFee.Components"><Name>dt</Name><Sql>        select PATIENT_NO,OUT_DATE,NAME, 
            wm_concat(distinct pack),
            case when wm_concat(distinct pack) like '%顺产%' then '分娩套餐' when  wm_concat(distinct pack) like '%剖宫%'  then  '分娩套餐' when  wm_concat(distinct pack) like '%产后康复%'  then  '月子套餐' else '' end  tclx, 
           case when wm_concat(distinct pack) like '%顺产%' then '顺产' when  wm_concat(distinct pack) like '%剖宫%'  then  '剖产' else '' end  sp,
             wm_concat(distinct room),
             substr(wm_concat(distinct room),instr(wm_concat(distinct room),'(',2)+1,5) fx,
          (sum(pub_cost)+ sum(own_cost) + sum(pay_cost) - sum(donate_cost)-sum(eco_cost)+(case when sum(tco)&lt;0 then -sum(tco) else sum(tco) end)) total ,
          sum(distinct relmony) relmony
         
    from （
   select j.INPATIENT_NO,j.PATIENT_NO,j.OUT_DATE,j.NAME, j.invoice_no,sum(pub_cost) pub_cost,sum(own_cost) own_cost,sum(pay_cost) pay_cost,sum(donate_cost) donate_cost,sum(eco_cost) eco_cost,sum(tco) tco,sum(distinct relmony) relmony,wm_concat(distinct pack) pack, wm_concat(distinct room) room from (
       select  t.INPATIENT_NO,info.PATIENT_NO,info.OUT_DATE,info.NAME, nvl(a.pub_cost,0) pub_cost, nvl(a.own_cost,0) own_cost, nvl(a.pay_cost , 0) pay_cost, nvl(a.donate_cost,0) donate_cost, nvl(a.eco_cost,0) eco_cost,
    (select nvl(sum(case when a.trans_kind=1 and a.reutrnorsupply_flag=2 and a.trans_type=1 then -a.cost when a.trans_kind=1 and  a.reutrnorsupply_flag=2 and a.trans_type=1 then -a.cost else a.cost end ),0) from fin_ipb_balancepay a where a.invoice_no = t.invoice_no and a.trans_type = t.trans_type and a.pay_way = 'TCO') tco,
     (select nvl(sum(case when a.trans_kind=1 and a.reutrnorsupply_flag=2 and a.trans_type=1 then -a.cost when a.trans_kind=1 and  a.reutrnorsupply_flag=2 and a.trans_type=1 then -a.cost else a.cost end ),0) from fin_ipb_balancepay a where a.invoice_no = t.invoice_no and a.trans_type = t.trans_type and a.pay_way = 'PR') relmony,
     
   a.invoice_no,(select wm_concat(g.PACKAGE_NAME) from exp_package g where g.cost_invoice=a.invoice_no ) pack,
   (select wm_concat(ITEM_NAME) from fin_ipb_itemlist g  where g.invoice_no=a.invoice_no and ITEM_NAME like '%平方米%' ) room
   --,(select sum(distinct g.REAL_COST)  from exp_package g where g.cost_invoice=a.invoice_no ) relmony
 from fin_ipb_balancehead t
   left join fin_ipb_balancelist a on a.invoice_no = t.invoice_no and a.trans_type = t.trans_type 
   left join fin_ipr_inmaininfo info on info.INPATIENT_NO=t.INPATIENT_NO
   where t.balance_date between to_date('&amp;dtBeginTime','yyyy-mm-dd') and to_date('&amp;dtEndTime','yyyy-mm-dd')+1 
          and (info.NAME like '%&amp;name%' or '&amp;name' is null ) ) j  group by j.INPATIENT_NO,j.PATIENT_NO,j.OUT_DATE,j.NAME, j.invoice_no
   
   ) group by INPATIENT_NO,PATIENT_NO,OUT_DATE,NAME</Sql><AddMapRow>false</AddMapRow><AddMapColumn>false</AddMapColumn><AddMapData>false</AddMapData><AddMapSourceData>false</AddMapSourceData><IsCross>false</IsCross><SqlType>MainReportUsing</SqlType><CrossRows></CrossRows><CrossColumns></CrossColumns><CrossValues></CrossValues><CrossCombinColumns></CrossCombinColumns><SumColumns></SumColumns><CrossGroupColumns></CrossGroupColumns><IsSumRow>true</IsSumRow><SumRows></SumRows><RowGroup /></QueryDataSource></QueryDataSource><QueryFilePath>Report\门诊财务报表\爱博恩\出院结算设置.xml</QueryFilePath><PrintInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.PrintInfo,SOC.HISFC.OutpatientFee.Components"><PaperSize Type="System.Drawing.Printing.PaperSize,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Height>1169</Height><PaperName>A4</PaperName><RawKind>0</RawKind><Width>850</Width></PaperSize><SelectPage>false</SelectPage></PrintInfo></ReportQueryInfo>