<ReportQueryInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.ReportQueryInfo,SOC.HISFC.OutpatientFee.Components"><List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>0</Index><Name>dtBeginTime</Name><Text>开始时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>-1</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>1</Index><Name>dtEndTime</Name><Text>结束时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>0</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>220</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>2</Index><Name>type</Name><Text>收费类型：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>440</X><Y>2</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName> select '正常收费单','正常收费单' from dual union all select '辅助治疗','辅助治疗' from dual union all select '预交金','预交金' from dual union all select '医美充值','医美充值' from dual union all select '项目储值','项目储值' from dual</DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>3</Index><Name>txtName</Name><Text>姓名/(客户)卡号：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.TextBoxType,SOC.HISFC.OutpatientFee.Components"><IsPadLeft>false</IsPadLeft><Length>10</Length><PadLeftName>0</PadLeftName><DefaultDataSource></DefaultDataSource><IsEnterFilter>true</IsEnterFilter><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>660</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>4</Index><Name>yjqddm</Name><Text>一级渠道：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>35</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName>select distinct kh.yjqddm,kh.yjqdmc from inf_khsx_abe kh where kh.yjqddm is not null order by kh.yjqddm</DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>5</Index><Name>ejqddm</Name><Text>二级渠道：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>220</X><Y>35</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName>select distinct kh.ejqddm,kh.ejqdmc from inf_khsx_abe kh where kh.yjqddm is not null order by kh.ejqddm</DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>6</Index><Name>sjqddm</Name><Text>三级渠道：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>440</X><Y>35</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName>select distinct kh.sjqddm,kh.sjqdmc from inf_khsx_abe kh where kh.yjqddm is not null order by to_number(kh.sjqddm)</DataSourceTypeName><Enabled>true</Enabled></ControlType></List></List><QueryDataSource><QueryDataSource Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryDataSource,SOC.HISFC.OutpatientFee.Components"><Name>dtSource</Name><Sql> select  --decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道),0,院区,'合计：') 院区, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,票据号,'合计：')  票据号, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,姓名,'/') 姓名, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,卡号,'/') 卡号, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,医美客户卡号,'/') 医美客户卡号, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,类型,'/') 类型, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,是否套餐开单,'/') 是否套餐开单, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,套餐名称,'/') 套餐名称, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,项目名称,'/') 项目名称, 
        sum(合计) 合计, 
        sum(西药费) 西药费, 
        sum(中药费) 中药费, 
        sum(挂号费) 挂号费, 
        sum(诊查费) 诊查费, 
        sum(检查费) 检查费, 
        sum(检验费) 检验费, 
        sum(治疗费) 治疗费, 
        sum(手术费) 手术费, 
        sum(麻醉费) 麻醉费, 
        sum(护理费) 护理费, 
        sum(材料费) 材料费, 
        sum(其他费) 其他费, 
        sum(round(case when 现金=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 现金/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 现金, 
        sum(round(case when 商保=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 商保/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 商保, 
        sum(round(case when 转账=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 转账/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 转账, 
        sum(round(case when POS=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else POS/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) POS, 
        sum(round(case when 支付宝=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 支付宝/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 支付宝, 
        sum(round(case when 应收其他=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 应收其他/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 应收其他, 
        sum(round(case when 医美储值=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 医美储值/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 医美储值, 
        sum(round(case when 医美储值赠送=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 医美储值赠送/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 医美储值赠送, 
        sum(round(case when 全院储值=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 全院储值/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 全院储值,
        sum(round(case when 项目储值=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 项目储值/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 项目储值,  
        sum(round(case when 优惠=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 优惠/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 优惠, 
        sum(round(case when 预交金=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 预交金/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 预交金, 
        sum(round(case when 员工折扣=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 员工折扣/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 员工折扣, 
        sum(round(case when 积分=0 or (现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分) =0 then 0 else 积分/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2)) 积分, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,开单人,'/') 开单人, 
        开单时间, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,收费员,'/') 收费员, 
        收费时间, 
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,支付备注,'/') 支付备注,
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称),0,科室名称,'/') 科室名称
        /*,
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道),0,一级渠道,'/') 一级渠道,
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道),0,二级渠道,'/') 二级渠道,
        decode(grouping_id(院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道),0,三级渠道,'/') 三级渠道*/
        /*院区, 
        票据号, 
        姓名, 
        卡号, 
        医美客户卡号, 
        类型, 
        是否套餐开单, 
        套餐名称, 
        项目名称, 
        合计, 
        西药费, 
        中药费, 
        挂号费, 
        诊查费, 
        检查费, 
        检验费, 
        治疗费, 
        手术费, 
        麻醉费, 
        护理费, 
        材料费, 
        其他费, 
        round(case when 现金=0 then 0 else 现金/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 现金, 
        round(case when 商保=0 then 0 else 商保/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 商保, 
        round(case when 转账=0 then 0 else 转账/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 转账, 
        round(case when POS=0 then 0 else POS/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) POS, 
        round(case when 支付宝=0 then 0 else 支付宝/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 支付宝, 
        round(case when 应收其他=0 then 0 else 应收其他/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 应收其他, 
        round(case when 医美储值=0 then 0 else 医美储值/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 医美储值, 
        round(case when 医美储值赠送=0 then 0 else 医美储值赠送/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 医美储值赠送, 
        round(case when 全院储值=0 then 0 else 全院储值/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 全院储值, 
        round(case when 优惠=0 then 0 else 优惠/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 优惠, 
        round(case when 预交金=0 then 0 else 预交金/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 预交金, 
        round(case when 员工折扣=0 then 0 else 员工折扣/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 员工折扣, 
        round(case when 积分=0 then 0 else 积分/(现金+商保+转账+POS+支付宝+应收其他+医美储值+医美储值赠送+全院储值+项目储值+优惠+预交金+员工折扣+积分)*合计 end,2) 积分, 
        开单人, 
        开单时间, 
        收费员, 
        收费时间, 
        支付备注*/
  from (
      select decode(xf.hospital_id,'IBORN','广州爱博恩妇产医院') 院区,
             case when xf.sflx in ('11','12','13','15','19') then '['||'退'||']' end||xf.sfdh 票据号, 
             xf.khxm 姓名,
             xf.pid 卡号,
             xf.khkh 医美客户卡号,
             case when xf.sflx in ('3','13') then '医美充值' 
                  when xf.sflx in ('2','12') then '预交金' 
                  when xf.sflx in ('5','15') then '辅助治疗' 
                  when xf.sflx in ('1','11') then '正常收费单'
                  when xf.sflx in ('9','19') then '项目储值' end 类型,
             decode(xf.sftckd,'Y','是','否') 是否套餐开单,
             xf.tcmc 套餐名称,
             case when xf.sflx in ('3','13') then '医美充值' when xf.sflx in ('2','12') then '预交金' else xf.xmmc end 项目名称,
             sum(xf.zhje) 合计,
             nvl(sum(case when xf.fylx='西药' then xf.zhje else 0 end),0) 西药费,
             nvl(sum(case when xf.fylx in ('中成药','中草药') then xf.zhje else 0 end),0) 中药费,
             nvl(sum(case when xf.fylx='挂号费' then xf.zhje else 0 end),0) 挂号费,
             nvl(sum(case when xf.fylx='诊查费' then xf.zhje else 0 end),0) 诊查费,
             nvl(sum(case when xf.fylx in ('检查费','CT','MRI') then xf.zhje else 0 end),0) 检查费,
             nvl(sum(case when xf.fylx='检验费' then xf.zhje else 0 end),0) 检验费,
             nvl(sum(case when xf.fylx='治疗费' then xf.zhje else 0 end),0) 治疗费,
             nvl(sum(case when xf.fylx='手术费' then xf.zhje else 0 end),0) 手术费,
             nvl(sum(case when xf.fylx='麻醉费' then xf.zhje else 0 end),0) 麻醉费,
             nvl(sum(case when xf.fylx='护理费' then xf.zhje else 0 end),0) 护理费,
             nvl(sum(case when xf.fylx='材料费' then xf.zhje else 0 end),0) 材料费,
             nvl(sum(case when xf.fylx='其他费用' or xf.fylx is null then xf.zhje else 0 end),0) 其他费,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='CA'),0) 现金,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='CI'),0) 商保,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='PO'),0) 转账,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='UP'),0) POS,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='ZB'),0) 支付宝,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='YE'),0) 应收其他,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='YS'),0) 医美储值,
             nvl((select sum(distinct (case when zf.bjje=zf.xjje then zf.zsje else zf.xjje-zf.bjje end)*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='YS'),0) 医美储值赠送,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='QYYS'),0) 全院储值,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='CZK'),0) 项目储值,
             nvl((select sum(zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='RC'),0) 优惠,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='DE'),0) 预交金,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='YGZK'),0) 员工折扣,
             nvl((select sum(distinct zf.bjje*decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1)) from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh and cd.code='CO'),0) 积分,
             xf.xdrxm 开单人,
             xf.xdsj 开单时间,
             xf.syyxm 收费员,
             xf.jzsj 收费时间,
             (select wm_concat(distinct case when zf.bz is not null then cd.name||':'||zf.bz else ''end) bz from inf_zffs_abe zf left join com_dictionary cd on cd.type='YMPAYMODES' and  zf.sflxmc=cd.name where zf.sfbh=xf.sfdh) 支付备注,
             kh.yjqdmc 一级渠道,
             kh.ejqdmc 二级渠道,
             kh.sjqdmc 三级渠道,
             xf.ksmc 科室名称
        from inf_xfmx_abe xf
        left join inf_khsx_abe kh on xf.khkh=kh.khkh
       where xf.syygh!='admin'
         and xf.jzsj between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1 
         and (xf.khxm like '%&amp;txtName%' or xf.khkh like '%&amp;txtName%' or '&amp;txtName' is null)
         and ((case when xf.sflx in ('3','13') then '医美充值' when xf.sflx in ('2','12') then '预交金' when xf.sflx in ('5','15') then '辅助治疗' when xf.sflx in ('1','11') then '正常收费单' when xf.sflx in ('9','19') then '项目储值' end)='&amp;type' or '&amp;type'='ALL')
   /*      and (kh.yjqddm='&amp;yjqddm' or '&amp;yjqddm'='ALL')
         and (kh.ejqddm='&amp;ejqddm' or '&amp;ejqddm'='ALL')
         and (kh.sjqddm='&amp;sjqddm' or '&amp;sjqddm'='ALL')*/
         --and xf.sfdh='BL202011240011'
       group by xf.hospital_id,
                case when xf.sflx in ('11','12','13','15','19') then '['||'退'||']' end ,
                xf.sfdh,
                xf.khxm ,
                xf.pid ,
                xf.khkh,
                xf.xdrxm,
                xf.xdsj,
                xf.jzsj,
                decode(xf.sflx,1,1,2,1,3,1,5,1,11,-1,12,-1,13,-1,15,-1,9,1,19,-1),
                case when xf.sflx in ('3','13') then '医美充值' when xf.sflx in ('2','12') then '预交金' when xf.sflx in ('5','15') then '辅助治疗' 
                     when xf.sflx in ('1','11') then '正常收费单' when xf.sflx in ('9','19') then '项目储值' end ,
                decode(xf.sftckd,'Y','是','否'),
                xf.tcmc,
                case when xf.sflx in ('3','13') then '医美充值' when xf.sflx in ('2','12') then '预交金' else xf.xmmc end,
                xf.syyxm,
                kh.yjqdmc ,
                kh.ejqdmc ,
                kh.sjqdmc,
                xf.ksmc
                
       order by xf.sfdh,xf.jzsj )a
 group by rollup((院区,票据号,姓名,卡号,医美客户卡号,类型,是否套餐开单,套餐名称,开单人,开单时间,收费员,收费时间,支付备注,项目名称,一级渠道,二级渠道,三级渠道,科室名称)) </Sql><AddMapRow>false</AddMapRow><AddMapColumn>false</AddMapColumn><AddMapData>false</AddMapData><AddMapSourceData>false</AddMapSourceData><IsCross>false</IsCross><SqlType>MainReportUsing</SqlType><CrossRows></CrossRows><CrossColumns></CrossColumns><CrossValues></CrossValues><CrossCombinColumns></CrossCombinColumns><SumColumns></SumColumns><CrossGroupColumns></CrossGroupColumns><IsSumRow>true</IsSumRow><SumRows></SumRows><RowGroup /></QueryDataSource></QueryDataSource><QueryFilePath>Report\门诊财务报表\爱博恩\医美系统收费统计设置.xml</QueryFilePath><PrintInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.PrintInfo,SOC.HISFC.OutpatientFee.Components"><PaperSize Type="System.Drawing.Printing.PaperSize,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Height>1169</Height><PaperName>A4</PaperName><RawKind>0</RawKind><Width>850</Width></PaperSize><SelectPage>false</SelectPage></PrintInfo></ReportQueryInfo>