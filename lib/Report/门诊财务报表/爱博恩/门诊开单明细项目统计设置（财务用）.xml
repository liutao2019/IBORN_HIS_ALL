<ReportQueryInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.ReportQueryInfo,SOC.HISFC.OutpatientFee.Components"><List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>0</Index><Name>dtBeginTime</Name><Text>开始时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>-1</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>1</Index><Name>dtEndTime</Name><Text>结束时间：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>0</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>220</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>2</Index><Name>cmbDept</Name><Text>开单科室：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>430</X><Y>2</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName>select dept_code,dept_name,DEPT_ENAME,SPELL_CODE,WB_CODE from com_department where regdept_flag = '1' ORDER BY dept_code</DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>3</Index><Name>txtItemName</Name><Text>开立项目：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.TextBoxType,SOC.HISFC.OutpatientFee.Components"><IsPadLeft>false</IsPadLeft><Length>10</Length><PadLeftName>0</PadLeftName><DefaultDataSource></DefaultDataSource><IsEnterFilter>true</IsEnterFilter><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>220</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>630</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>4</Index><Name>code</Name><Text>费用类别：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.ComboBoxType,SOC.HISFC.OutpatientFee.Components"><IsAddAll>true</IsAddAll><AllValue Type="FS.FrameWork.Models.NeuObject,FrameWork"><ID>ALL</ID><Name>全部</Name><Memo></Memo></AllValue><DataSource /><DefaultDataSource /><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>930</X><Y>2</Y></Location><QueryDataSource>Sql</QueryDataSource><DataSourceTypeName> select cd.code,cd.name from com_dictionary cd where cd.type='MINFEE' </DataSourceTypeName><Enabled>true</Enabled></ControlType></List></List><QueryDataSource><QueryDataSource Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryDataSource,SOC.HISFC.OutpatientFee.Components"><Name>dtSource</Name><Sql>select decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,t.card_no,'合计:') card_no,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,t2.name,'/') name,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,cd.name,'/') feename,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0, case when nvl(length(t.package_name),0)&gt; 0 then '['||t.package_name||']'||t.item_name else t.item_name end,'/') item_name,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,t.specs,'/') specs,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,to_char(t.qty,'999.99'),'/') qty,
       sum(nvl(t.own_cost,0)) own_cost,
       sum(nvl(t.own_cost,0) - nvl(t.eco_cost,0) - nvl(t.donate_cost,0)) real_cost,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0, fun_get_dept_name(fr.dept_code),'/') reg_dpcd,
       nvl(fun_get_employee_name(fr.doct_code),fun_get_employee_name(t.fee_cpcd)) doct_name,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,to_char(t.oper_date,'YYYY-MM-DD HH24:MI:SS'),'/') oper_date,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,fun_get_employee_name(t.fee_cpcd),'/') fee_cpcd,
       decode(grouping_id(fr.doct_code,t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name),0,to_char(t.fee_date,'YYYY-MM-DD HH24:MI:SS'),'/') fee_date
  from fin_opb_feedetail t
  left join com_patientinfo t2 on t.card_no = t2.card_no
  left join com_dictionary cd on cd.type='MINFEE' and t.fee_code=cd.code
  left join fin_opr_register fr on t.clinic_code=fr.clinic_code
 where 1 = 1
   --and t.cancel_flag = '1' 
   and t.pay_flag = '1'
   and (fr.dept_code = '&amp;cmbDept' or 'ALL' = '&amp;cmbDept')
   and (t.item_name like '%&amp;txtItemName%' or nvl(t.item_name,'1') = '1')
   and t.fee_date between to_date('&amp;dtBeginTime', 'YYYY-MM-DD') and  to_date('&amp;dtEndTime', 'YYYY-MM-DD')+1   
   and (cd.code='&amp;code' or '&amp;code'='ALL') 
 group by rollup(fr.doct_code,(t.card_no, t2.name,t.item_name,t.package_name,t.specs,t.qty,fr.dept_code,t.oper_date,t.fee_cpcd, t.fee_date,cd.name))
</Sql><AddMapRow>false</AddMapRow><AddMapColumn>false</AddMapColumn><AddMapData>false</AddMapData><AddMapSourceData>false</AddMapSourceData><IsCross>false</IsCross><SqlType>MainReportUsing</SqlType><CrossRows></CrossRows><CrossColumns></CrossColumns><CrossValues></CrossValues><CrossCombinColumns></CrossCombinColumns><SumColumns></SumColumns><CrossGroupColumns></CrossGroupColumns><IsSumRow>true</IsSumRow><SumRows></SumRows><RowGroup /></QueryDataSource></QueryDataSource><QueryFilePath>\Report\门诊财务报表\爱博恩\门诊开单明细项目统计设置（财务用）.xml</QueryFilePath><PrintInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.PrintInfo,SOC.HISFC.OutpatientFee.Components"><PaperSize Type="System.Drawing.Printing.PaperSize,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Height>1169</Height><PaperName>A4</PaperName><RawKind>0</RawKind><Width>850</Width></PaperSize><SelectPage>false</SelectPage></PrintInfo></ReportQueryInfo>