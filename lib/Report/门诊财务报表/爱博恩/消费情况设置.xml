<ReportQueryInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.ReportQueryInfo,SOC.HISFC.OutpatientFee.Components"><List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>0</Index><Name>dtBeginTime</Name><Text>时间范围：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>-1</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>10</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>1</Index><Name>dtEndTime</Name><Text>~</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.DateTimeType,SOC.HISFC.OutpatientFee.Components"><AddDays>0</AddDays><AddMonths>0</AddMonths><CustomFormat>yyyy-MM-dd</CustomFormat><DefaultDataSource></DefaultDataSource><Format>Custom</Format><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>220</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List><List Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryControl,SOC.HISFC.OutpatientFee.Components"><Index>2</Index><Name>dtName</Name><Text>姓名/卡号：</Text><IsAddText>true</IsAddText><ControlType Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.ControlType.TextBoxType,SOC.HISFC.OutpatientFee.Components"><IsPadLeft>false</IsPadLeft><Length>10</Length><PadLeftName>0</PadLeftName><DefaultDataSource></DefaultDataSource><IsEnterFilter>true</IsEnterFilter><IsLike>false</IsLike><LikeStr>%{0}%</LikeStr><Size Type="System.Drawing.Size,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Width>120</Width><Height>20</Height></Size><Location Type="System.Drawing.Point,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><X>450</X><Y>2</Y></Location><QueryDataSource>Dictionary</QueryDataSource><DataSourceTypeName></DataSourceTypeName><Enabled>true</Enabled></ControlType></List></List><QueryDataSource><QueryDataSource Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.QueryDataSource,SOC.HISFC.OutpatientFee.Components"><Name>dt</Name><Sql>select * from (
  select   t.CARD_NO , t.姓名, t.门诊消费, (select sum(PREPAY_COST) from fin_opb_accountprepay where CARD_NO in (t.CARD_NO)  and OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1) as 门诊充值 , zy.住院消费 ,zy.住院充值 as 住院押金,tc.套餐，tc.套餐消费,(select sum(amount) from EXP_PACKAGEDEPOSIT where  CARD_NO=t.card_no  and OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1) as 套餐押金 
    from (
        select infos.CARD_NO , infos.name as 姓名,sum(ivo.OWN_COST) as 门诊消费
          from com_patientinfo infos 
          left join  fin_opb_invoiceinfo ivo  on infos.CARD_NO=ivo.CARD_NO and ivo.OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1
          left join fin_opb_paymode paymd  on ivo.invoice_no in(paymd.invoice_no) and paymd.mode_code in ('CA','WP','ZB','PO','UP')
       group by  infos.CARD_NO,infos.name ) t 
     left join 
        (     select u.cardid, u.姓名,u.住院消费 ,(select sum(pays.PREPAY_COST) 
              from fin_ipb_inprepay pays,fin_ipr_inmaininfo fo  
              where fo.inpatient_no in (pays.inpatient_no) and fo.card_no=u.cardid and pays.OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1 ) as 住院充值
              from (
                 select info.CARD_NO as cardid, info.name as 姓名,sum(bast.own_cost) as 住院消费
                 from fin_ipr_inmaininfo info 
                 left join fin_ipb_balancehead bast on info.inpatient_no=bast.inpatient_no
                 left join fin_opb_paymode paymode on bast.invoice_no in(paymode.invoice_no) 
                 where paymode.mode_code in ('CA','WP','ZB','PO','UP') and  bast.BALANCE_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1
          group by info.CARD_NO, info.name) u) zy 
      on  t.CARD_NO= zy.cardid 
      left join 
           (     select pp.card_no,pp.patient_name ,pp.套餐,(select sum(REAL_COST) from exp_packagecost where  USE_CARD_NO=pp.card_no  and OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1) as 套餐消费  from (  
                  select t.card_no,t.patient_name ,sum(t.real_cost) as 套餐
                    from (
                      select distinct exp.card_no,exp.patient_name,mod.REAL_COST
                      from   exp_package exp   
                      left join  EXP_PACKAGEINVOICE vo on exp.invoice_no in (vo.invoice_no) 
                      left join  EXP_PACKAGEPAYMODE mod  on mod.invoice_no = exp.invoice_no and mod.mode_code in ('CA','WP','ZB','PO','UP')     
                      where exp.OPER_DATE between to_date('&amp;dtBeginTime' ,'yyyy-MM-dd')  and to_date( '&amp;dtEndTime','yyyy-MM-dd') +1       
        ) t group by t.card_no,t.patient_name) pp ) tc 
      on t.CARD_NO= tc.card_no ) uu 
   where (card_no like '%&amp;dtName%' or uu.姓名 like '%&amp;dtName%') and 1=1</Sql><AddMapRow>false</AddMapRow><AddMapColumn>true</AddMapColumn><AddMapData>false</AddMapData><AddMapSourceData>false</AddMapSourceData><IsCross>false</IsCross><SqlType>MainReportUsing</SqlType><CrossRows></CrossRows><CrossColumns></CrossColumns><CrossValues></CrossValues><CrossCombinColumns></CrossCombinColumns><SumColumns></SumColumns><CrossGroupColumns></CrossGroupColumns><IsSumRow>true</IsSumRow><SumRows></SumRows><RowGroup /></QueryDataSource></QueryDataSource><QueryFilePath>Report\门诊财务报表\爱博恩\消费情况设置.xml</QueryFilePath><PrintInfo Type="FS.SOC.HISFC.OutpatientFee.Components.Report.Common.Setting.PrintInfo,SOC.HISFC.OutpatientFee.Components"><PaperSize Type="System.Drawing.Printing.PaperSize,System.Drawing, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"><Height>1169</Height><PaperName>A4</PaperName><RawKind>0</RawKind><Width>850</Width></PaperSize><SelectPage>false</SelectPage></PrintInfo></ReportQueryInfo>